<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sudan Play - متجر التطبيقات السوداني</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* الأنماط الحالية تبقى كما هي */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: rgb(74, 107, 255);
            --secondary: rgb(255, 94, 125);
            --accent: rgb(46, 196, 182);
            --dark: rgb(30, 30, 45);
            --light: rgb(248, 249, 254);
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --gradient-light: linear-gradient(135deg, rgba(74, 107, 255, 0.1) 0%, rgba(255, 94, 125, 0.1) 100%);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        body {
            background-color: var(--light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* باقي الأنماط تبقى كما هي */
        /* ... */

    </style>
</head>
<body onload="loadApps()">
    <header>
        <nav>
            <div class="logo">
                <h1>Sudan Play</h1>
            </div>
            <div class="nav-links">
                <a href="#apps"><i class="fas fa-th"></i> التطبيقات</a>
                <a href="#about"><i class="fas fa-info-circle"></i> عن المتجر</a>
                <a href="#contact"><i class="fas fa-envelope"></i> تواصل معنا</a>
                <button class="submit-app-btn" onclick="openSubmitAppModal()">
                    <i class="fas fa-plus"></i> نشر تطبيق
                </button>
            </div>
        </nav>
    </header>

    <!-- المحتوى الحالي يبقى كما هو -->
    <section class="hero">
        <h2>متجر التطبيقات السوداني</h2>
        <p>اكتشف وحمل أفضل التطبيقات والألعاب المحلية والعالمية المصممة خصيصًا لك.</p>
        <a href="#apps"><button>ابدأ التصفح <i class="fas fa-arrow-down"></i></button></a>
    </section>

    <!-- باقي المحتوى -->
    <!-- ... -->

    <!-- نافذة نشر التطبيق -->
    <div id="submitAppModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeSubmitAppModal()">&times;</span>
            <h2 style="color: var(--primary); margin-bottom: 20px;">نشر تطبيق جديد</h2>
            
            <div class="bank-info">
                <h4><i class="fas fa-university"></i> معلومات الحساب البنكي</h4>
                <p><strong>اسم البنك:</strong> بنك السودان المركزي</p>
                <p><strong>رقم الحساب:</strong> 1234567890</p>
                <p><strong>اسم المستفيد:</strong> Monty GO SDN-Co.LTD</p>
                <p><strong>مبلغ التحويل:</strong> 50 جنيه سوداني</p>
            </div>
            
            <form class="submit-form" id="submitAppForm">
                <div class="form-group">
                    <label for="appType">نوع التطبيق</label>
                    <select id="appType" class="form-control" required>
                        <option value="">اختر نوع التطبيق</option>
                        <option value="ألعاب">ألعاب</option>
                        <option value="أدوات">أدوات</option>
                        <option value="تواصل">تواصل</option>
                        <option value="تعليم">تعليم</option>
                        <option value="ترفيه">ترفيه</option>
                        <option value="مال وأعمال">مال وأعمال</option>
                        <option value="أخرى">أخرى</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="appName">اسم التطبيق</label>
                    <input type="text" id="appName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="appImages">روابط صور التطبيق (افصل بينها بفاصلة)</label>
                    <textarea id="appImages" class="form-control form-textarea" placeholder="https://example.com/image1.jpg, https://example.com/image2.jpg"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="appLink">رابط التطبيق (APK أو رابط المتجر)</label>
                    <input type="url" id="appLink" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="transactionId">رقم عملية التحويل البنكي</label>
                    <input type="text" id="transactionId" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="devName">اسم المطور/المستخدم</label>
                    <input type="text" id="devName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="companyName">اسم الشركة (اختياري)</label>
                    <input type="text" id="companyName" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="devEmail">البريد الإلكتروني</label>
                    <input type="email" id="devEmail" class="form-control" required>
                </div>
                
                <button type="submit" class="submit-btn" id="submitAppBtn">إرسال الطلب للمراجعة <i class="fas fa-paper-plane"></i></button>
            </form>
        </div>
    </div>

    <!-- باقي النوافذ المنبثقة -->
    <!-- ... -->

    <div id="toast-message"></div>

    <footer>
        &copy; 2025 Sudan Play. جميع الحقوق محفوظة. - واتساب: 249127432167 - Monty Go SDN-Co.LTD
    </footer>

    <!-- 🔑 إضافة Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script> 
    
    <script>
        // 🔑 **مفاتيح Firebase - نفس المفاتيح المستخدمة في login.html**
        const firebaseConfig = {
            apiKey: "AIzaSyBJE_Ee-Dyh83iny45eH8lVtTSrIVqTzOI",
            authDomain: "sudan-play.firebaseapp.com",
            projectId: "sudan-play",
            storageBucket: "sudan-play.firebasestorage.app",
            messagingSenderId: "981764948623",
            appId: "1:981764948623:web:00e5c9268198f70e39a6fa",
            measurementId: "G-Y6NP2MNQR9"
        };

        // تهيئة Firebase
        let db;
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            db = firebase.firestore();
            console.log("✅ Firebase initialized successfully in index.html");
        } catch (error) {
            console.error("❌ Firebase initialization error:", error);
        }

        // دالة عرض الرسائل
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast-message');
            toast.textContent = message;
            toast.className = "show";
            
            setTimeout(function() {
                toast.className = toast.className.replace("show", "");
            }, duration);
        }

        // دالة فتح نافذة نشر التطبيق
        function openSubmitAppModal() {
            document.getElementById('submitAppModal').style.display = 'block';
        }

        // دالة إغلاق نافذة نشر التطبيق
        function closeSubmitAppModal() {
            document.getElementById('submitAppModal').style.display = 'none';
        }

        // إرسال نموذج نشر التطبيق
        document.getElementById('submitAppForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitAppBtn');
            const originalText = submitBtn.innerHTML;
            submitBtn.classList.add('loading');
            
            try {
                // جمع بيانات النموذج
                const formData = {
                    appType: document.getElementById('appType').value,
                    appName: document.getElementById('appName').value,
                    appImages: document.getElementById('appImages').value.split(',').map(img => img.trim()).filter(img => img.length > 0),
                    appLink: document.getElementById('appLink').value,
                    transactionId: document.getElementById('transactionId').value,
                    devName: document.getElementById('devName').value,
                    companyName: document.getElementById('companyName').value || '',
                    devEmail: document.getElementById('devEmail').value,
                    reviewStatus: 'Pending',
                    submissionDate: firebase.firestore.FieldValue.serverTimestamp()
                };

                console.log("📤 Sending data to Firebase:", formData);

                // التحقق من اتصال Firebase
                if (!db) {
                    throw new Error("Firebase not initialized");
                }

                // إرسال البيانات إلى مجموعة 'submissions'
                const docRef = await db.collection('submissions').add(formData);
                console.log("✅ Submission successful with ID:", docRef.id);
                
                // إعادة تعيين النموذج وإظهار رسالة النجاح
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = originalText;
                
                showToast('✅ تم إرسال طلب نشر التطبيق بنجاح وسيتم مراجعته خلال 30 ساعة');
                closeSubmitAppModal();
                document.getElementById('submitAppForm').reset();
                
            } catch (error) {
                console.error("❌ Error submitting app:", error);
                submitBtn.classList.remove('loading');
                submitBtn.innerHTML = originalText;
                
                let errorMessage = 'حدث خطأ أثناء إرسال الطلب، يرجى المحاولة مرة أخرى';
                
                if (error.code) {
                    switch (error.code) {
                        case 'permission-denied':
                            errorMessage = 'خطأ في الأذونات: يرجى التحقق من إعدادات قاعدة البيانات';
                            break;
                        case 'unavailable':
                            errorMessage = 'تعذر الاتصال بالخادم، يرجى التحقق من اتصال الإنترنت';
                            break;
                        default:
                            errorMessage = `خطأ: ${error.message}`;
                    }
                }
                
                showToast('❌ ' + errorMessage);
            }
        });

        // باقي الدوال الحالية (loadApps, filterApps, etc.)
        // ... 

        // إغلاق النوافذ المنبثقة عند النقر خارجها
        window.onclick = function(event) {
            const modals = document.getElementsByClassName('modal');
            for (let modal of modals) {
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            }
        }

        // اختبار اتصال Firebase عند التحميل
        document.addEventListener('DOMContentLoaded', function() {
            console.log("🚀 Main page loaded with Firebase");
            
            if (db) {
                console.log("✅ Firebase is connected and ready");
            } else {
                console.error("❌ Firebase is not connected");
                showToast("⚠️ تحذير: هناك مشكلة في الاتصال بالخادم", 5000);
            }
        });
    </script>
</body>
</html>
